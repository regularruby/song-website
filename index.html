<html lang="en">

<head>
    <meta charset="utf-8">

    <title>music</title>
    <meta name="description" content="music">
    <meta name="author" content="SitePoint">
    <link rel="stylesheet" href="theme.css">

</head>

<body >
    <table width="100%">
        <tr>
            <td id="ip" width="10%"></td>
            <td id="ping" width="10%"></td>
        </tr>
    </table>
    <table id="data" width="100%"></table>
    <audio controls preload="auto">
        <source src="song.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script>
        $(function () {
            var socket = io();
            var addr;

            socket.on('handshake', address => {
                console.log("handshake-success");
                socket.emit("handshake-success");
                addr = address;
            })

            socket.on('pingTest', time => {
                socket.emit("pingRebound",time);
            });

            socket.on('data', users => {
                let str ="<tr><td>Synced:</td><td>IP Address:</td><td>Ping(ms):</td><td>Client ID:</td></tr>"
                users.forEach(user => {
                    let synced = "<td width='10%' style='color:yellow;'>?</td>"
                    if (user.sync == true){
                        synced = "<td width='10%' style='color:green;'>True</td>"
                    } else if (user.sync == false){
                        synced = "<td width='8%' style='color:tomato;'>False</td>"
                    }
                    str = str.concat("<tr>" + synced + "<td width='12%'>" + user.addr +"</td><td width='9%'>" + user.ping + "</td><td >" + user.id + "</td></tr>")
                });
                printData("data", str);
                //socket.emit("syncingData", play, volume, timestamp)
            })

            socket.on('audio', (delay, play, volume, timestamp) => {
                setTimeout(() => {

                }, math.round(delay));
            })

        });

        function printData(id, data){
            document.getElementById(id).innerHTML = data;
        }
    </script>
</body>

</html>